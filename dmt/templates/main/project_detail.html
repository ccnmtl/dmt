{% extends 'base.html' %}
{% load markup %}

{% block title %}Project: {{object.name}}{% endblock %}

{% block css %}
<link rel="stylesheet" href="{{STATIC_URL}}css/tablecloth.css">
{% endblock %}

{% block primarynavtabs %}
{% endblock %}

{% block primarynavtabsright %}
{% endblock %}


{% block content %}
<ul class="breadcrumb">
  <li><a href="/"><span class="glyphicon glyphicon-home"></span></a></li>
  <li class="active">{{object.name}}</li>
</ul>

<h1>Project: {{object.name}}</h1>

<ul class="nav nav-pills">
	<li><a href="http://pmt.ccnmtl.columbia.edu/home.pl?mode=project;pid={{object.pid}}">Return to the old PMT</a></li>
	<li><a href="#" data-toggle="modal"
	data-target="#add-tracker"><span class="glyphicon glyphicon-time"></span> Add Tracker</a></li>
	<li><a href="#" data-toggle="modal" data-target="#add-todo">Add Todo(s)</a></li>
</ul>

<div class="modal fade" id="add-tracker" tabindex="-1" role="dialog" aria-labelledby="add-tracker-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="add-tracker-label">Add Tracker(s)</h4>
      </div>
      <div class="modal-body">
				<form id="add-tracker-form" action="/api/1.0/tracker/add/" method="post" role="form">
					<input type="hidden" name="pid" value="{{object.pid}}" id="tracker-pid-input" />

					<div class="row">
						<div class="col-sm-7">
							<input type="text" name="title" placeholder="task" 
										 id="tracker-task-input"
										 class="form-control"/>
						</div>

						<div class="col-sm-3">
							<input type="text" name="time" placeholder="time"
										 id="tracker-time-input"
										 class="form-control" />
						</div>

						<div class="col-sm-2">
							<input type="text" name="client" placeholder="client"
										 id="tracker-client-input"
										 class="form-control" />
						</div>
					</div>
				</form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="add-tracker-button">Add</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<form id="add-todo-form" action="add_todo/" method="post" role="form">
<div class="modal fade" id="add-todo" tabindex="-1" role="dialog" aria-labelledby="add-todo-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="add-todo-label">Add Todo(s)</h4>
      </div>
      <div class="modal-body">
				<div class="form-group">
					<input type="text" name="title_0" placeholder="task title" 
								 id="todo-title-input-0" class="form-control"/>
				</div>

				<div class="form-group">
					<input type="text" name="title_1" placeholder="task title" 
								 id="todo-title-input-1" class="form-control"/>
				</div>

				<div class="form-group">
					<input type="text" name="title_2" placeholder="task title" 
								 id="todo-title-input-2" class="form-control"/>
				</div>

				<div class="form-group">
					<input type="text" name="title_3" placeholder="task title" 
								 id="todo-title-input-3" class="form-control"/>
				</div>

				<div class="form-group">
					<input type="text" name="title_4" placeholder="task title" 
								 id="todo-title-input-4" class="form-control"/>
				</div>
			</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-primary"
        id="add-todo-button" value="Add"/>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</form>


<ul class="nav nav-tabs">
  <li><a href="#summary" data-toggle="tab">Summary</a></li>
  <li><a href="#details" data-toggle="tab">Details</a></li>
  <li><a href="#milestones" data-toggle="tab">Milestones</a></li>
  <li><a href="#reports" data-toggle="tab">Reports</a></li>
	<li><a href="#forum" data-toggle="tab">Forum Posts</a></li>
</ul>


<div class="tab-content">
	<div class="tab-pane fade in active" id="summary">
		<dl>
			<dt>Status</dt>
			<dd>{{object.status}}</dd>
			<dt>Description</dt>
			<dd>{{object.description|markdown}}</dd>
			<dt>URL</dt>
			<dd>{{object.url}}</dd>
{% if object.wiki_category %}
			<dt>Wiki Category</dt>
			<dd><a href="http://wiki.ccnmtl.columbia.edu/index.php/Category:{{object.wiki_category}}">{{object.wiki_category}}</a></dd>
{% endif %}
			</dd>
			<dt>Personnel</dt>
			<dd>
				{% for u in object.managers %}
						<a href="{{u.get_absolute_url}}">{{u.fullname}}</a>{% if not forloop.last %}, {% endif %}
					{% endfor %}
						{% for u in object.developers %}
						<a href="{{u.get_absolute_url}}">{{u.fullname}}</a>{% if not forloop.last %}, {% endif %}
						{% endfor %}
					{% for u in object.guests %}
						<a href="{{u.get_absolute_url}}">{{u.fullname}}</a>{% if not forloop.last %}, {% endif %}
						{% endfor %}
			</dd>
		</dl>


<table class="table table-condensed table-striped tablesorter" id="project-items">
	<thead>
		<tr>
			<th>Title</th>
			<th>Status</th>
			<th>Priority</th>
			<th>Target Date</th>
			<th>Owner</th>
			<th>Assigned To</th>
			<th>Last Modified</th>
		</tr>
	</thead>

	<tbody>

		{% for item in object.active_items %}
		<tr>
			<td>{% if item.is_bug %}<img src="{{STATIC_URL}}img/tinybug.gif"
	width="14" height="14"/> {% endif %}<a href="{{item.get_absolute_url}}">{{item.title}}</a></td>
			<td class="{{item.status_class}}">{{item.status}}</td>
			<td class="pr{{item.priority}}">{{item.priority_label}}</td>
			<td>{{item.target_date|date:"Y-m-d"}}</td>
			<td><a href="{{item.owner.get_absolute_url}}">{{item.owner}}</a></td>
			<td><a href="{{item.assigned_to.get_absolute_url}}">{{item.assigned_to}}</a></td>
			<td>{{item.last_mod|date:"Y-m-d"}}</td>
		</tr>
		{% endfor %}
</tbody>
</table>

	</div>

	<div class="tab-pane fade" id="details">
		<dl>
			<dt>Caretaker</dt>
			<dd><a href="{{object.caretaker.get_absolute_url}}">{{object.caretaker.first_name}} {{object.caretaker.last_name}}</a></dd>
			<dt>type</dt>
			<dd>{{object.type}}</dd>
			<dt>area</dt>
			<dd>{{object.area}}</dd>
			<dt>restricted?</dt>
			<dd>{{object.restricted}}</dd>
			<dt>approach</dt>
			<dd>{{object.approach}}</dd>
			<dt>info url</dt>
			<dd>{{object.info_url}}</dd>
			<dt>entry url</dt>
			<dd>{{object.entry_url}}</dd>
			<dt>eval url</dt>
			<dd>{{object.eval_url}}</dd>
			<dt>project number</dt>
			<dd>{{object.projnum}}</dd>
			<dt>scale</dt>
			<dd>{{object.scale}}</dd>
			<dt>distrib</dt>
			<dd>{{object.distrib}}</dd>
			<dt>poster?</dt>
			<dd>{{object.poster}}</dd>
		</dl>
	</div>

	<div class="tab-pane fade" id="milestones">
{% if object.milestone_set.count %}
<table class="table">
	<thead>
		<tr>
			<th>Name</th>
			<th>Target Date</th>
			<th>Status</th>
			<th># Open</th>
		</tr>
	</thead>

	<tbody>
		{% for milestone in object.milestone_set.all %}
		<tr>
			<td><a href="{{milestone.get_absolute_url}}">{{milestone.name}}</a></td>
			<td>{{milestone.target_date}}</td>
			<td class="{{milestone.status_class}}">{{milestone.status}}</td>
			<td>{{milestone.num_open_items}}</td>
		</tr>
		{% endfor %}
	</tbody>

</table>
{% endif %}
</div>

	<div class="tab-pane fade" id="reports">

		<ul>[NOT IMPLEMENTED YET]
			<li>weekly</li>
			<li>monthly</li>
			<li>quarterly</li>
			<li>semestral</li>
			<li>annual</li>
			<li>custom</li>
		</ul>

	</div>

	<div class="tab-pane fade" id="forum">



<ul class="nav nav-pills">
	<li><a href="#" data-toggle="modal" data-target="#add-node">Add Forum Post</a></li>
</ul>

<form id="add-node-form" action="add_node/" method="post" role="form">
<div class="modal fade" id="add-node" tabindex="-1" role="dialog" aria-labelledby="add-node-label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="add-node-label">Post to Project Forum</h4>
      </div>
      <div class="modal-body">
				<div class="form-group">
					<input type="text" name="subject" id="forum-post-subject"
								 class="form-control" placeholder="title/subject" />
				</div>
				<div class="form-group">
					<textarea name="body" class="form-control" rows="10"></textarea>
				</div>
			</div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <input type="submit" class="btn btn-primary" id="add-node-button" value="Post"/>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</form>



		{% for n in object.recent_forum_posts %}
<h2><a href="{{n.get_absolute_url}}">{{n.subject}}</a></h2>
<p class="byline">
by <a href="{{n.author.get_absolute_url}}">{{n.author.fullname}}</a>
| {{n.added}}
</p>
{{n.body|markdown}}

		{% endfor %}
	</div>

</div>
{% endblock %}

{% block js %}
  <script src="{{STATIC_URL}}js/jquery.tablesorter.min.js"></script>

<script>
$(document).ready(function() 
    { 
        $("#project-items").tablesorter({sortList: [[2,1], [1,0]]}); 

        $("#add-tracker-button").click(function(event) {
           var pid = $("#tracker-pid-input").val();
           var task = $("#tracker-task-input").val();
           var time = $("#tracker-time-input").val();
           var client = $("#tracker-client-input").val();

           $.ajax({
             type: "POST",
             url: "/api/1.0/trackers/add/",
             data: {pid: pid, task: task, time: time, client: client}
           }).done(function (msg) {
              $("#tracker-task-input").val("");
              $("#tracker-time-input").val("");
              $("#tracker-client-input").val("");
           });
           event.preventDefault();
        });
    } 
);
</script>

{% endblock %}
